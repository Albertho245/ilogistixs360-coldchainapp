<mvc:View
  controllerName="COLDCHAINAPP.controller.Distribucion"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core"
  displayBlock="true">

  <Page
    id="pageDistribucion"
    title="Mi Ruta de Distribución"
    backgroundDesign="Solid"
    showNavButton="true"
    navButtonPress=".onNavBack">

    <content>
      <VBox class="sapUiSmallMargin">

        <!-- ENCABEZADO DE INFORMACIÓN DEL CONDUCTOR -->
        <ObjectHeader
          title="{distribucion>/conductor/nombre}"
          intro="{distribucion>/conductor/unidad}"
          number="{distribucion>/resumen/progreso}"
          numberUnit="completado"
          icon="sap-icon://shipping-status"
          class="sapUiSmallMarginBottom" />

        <!-- RESUMEN DE RUTA -->
        <HBox justifyContent="SpaceAround" class="sapUiSmallMarginBottom">
          <ObjectStatus
            title="Total de Paradas"
            text="{distribucion>/resumen/totalParadas}" />
          <ObjectStatus
            title="Completadas"
            text="{distribucion>/resumen/completadas}"
            state="Success" />
          <ObjectStatus
            title="Pendientes"
            text="{distribucion>/resumen/pendientes}"
            state="Warning" />
        </HBox>

        <!-- MAPA DINÁMICO (centrado sin modificar su tamaño) -->
        <Panel
          headerText="Ruta Asignada (Mapa en Tiempo Real)"
          expandable="false"
          class="sapUiNoContentPadding sapUiSmallMarginBottom">
          <core:HTML
            id="mapFrame"
            content="{distribucion>/mapaEmbed}"
            style="display: block; margin: 0 auto;"
            class="sapUiSmallMarginBottom" />
        </Panel>

        <!-- PANEL DEL DESTINO ACTUAL -->
        <Panel
          headerText="Destino Actual"
          class="sapUiSmallMarginBottom"
          expandable="false"
          binding="{distribucion>/destinoActual}">
          <VBox>
            <Text
              text="{distribucion>cliente}"
              class="sapMTitle sapMTitleLarge sapUiSmallMarginBottom" />
            <Text text="{distribucion>direccion}" />
            <Text text="Hora estimada: {distribucion>horaEstimada}" />
            <Text text="Estado: {distribucion>estado}" />
            <Button
              text="Marcar como Entregado"
              icon="sap-icon://accept"
              type="Accept"
              press=".onCompletarEntrega"
              class="sapUiSmallMarginTop" />
          </VBox>
        </Panel>

        <!-- LISTA DE PARADAS -->
        <List
          headerText="Paradas del Día"
          items="{distribucion>/paradas}">
          <CustomListItem>
            <HBox justifyContent="SpaceBetween" alignItems="Center">
              <VBox>
                <ObjectIdentifier
                  title="{distribucion>cliente}"
                  text="{distribucion>direccion}" />
                <ObjectStatus
                  text="{distribucion>estado}"
                  state="{distribucion>estadoColor}" />
                <Text text="Hora estimada: {distribucion>horaEstimada}" />
              </VBox>
              <Button
                text="Ir"
                icon="sap-icon://navigation-right-arrow"
                type="Transparent"
                enabled="false" />
            </HBox>
          </CustomListItem>
        </List>

      </VBox>
    </content>
  </Page>
</mvc:View>
